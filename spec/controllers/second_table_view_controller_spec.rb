describe 'SecondTableViewController' do
  extend WebStub::SpecHelpers

  before do
      @response = { count: 10968,
                    page: 1,
                    first: 1,
                    last: 30,
                    hits: 30,
                    carrier: 0,
                    pageCount: 100,
                    Items: [
                      {
                        Item: {
                          itemName: "【中古】afb【ニンテンドー3DS】ドラゴンクエスト7　エデンの戦士たち【4988601007795】【RPG】",
                          catchcopy: "売れ筋！中古ゲームソフト",
                          itemCode: "wondergoo:10001397",
                          itemPrice: 2190,
                          itemCaption: "たったひとつの島から壮大な冒険が始まる！物語のはじまりは、世界にたったひとつしかない島「エスタード島」から。ほんとうにこの島だけしか存在しないと思われていた世界は、主人公とその友達・キーファ王子が偶然見つけた謎の石板をきっかけに、壮大な世界へと変化を遂げていく。",
                          itemUrl: "http://item.rakuten.co.jp/wondergoo/10001397/",
                          affiliateUrl: "",
                          imageFlag: 1,
                          mediumImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/wondergoo/cabinet/03459389/4988601007795.jpg?_ex=128x128"
                            }
                          ],
                          smallImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/wondergoo/cabinet/03459389/4988601007795.jpg?_ex=64x64"
                            }
                          ],
                          availability: 1,
                          taxFlag: 0,
                          postageFlag: 1,
                          creditCardFlag: 1,
                          shopOfTheYearFlag: 0,
                          shipOverseasFlag: 0,
                          shipOverseasArea: "",
                          asurakuFlag: 0,
                          asurakuClosingTime: "",
                          asurakuArea: "",
                          affiliateRate: 1,
                          startTime: "",
                          endTime: "",
                          reviewCount: 2,
                          reviewAverage: 5,
                          pointRate: 1,
                          pointRateStartTime: "",
                          pointRateEndTime: "",
                          giftFlag: 0,
                          shopName: "WonderGOO楽天市場店",
                          shopCode: "wondergoo",
                          shopUrl: "http://www.rakuten.co.jp/wondergoo/",
                          genreId: "562884"
                        }
                      },
                      {
                        Item: {
                          itemName: "【メール便発送可】【新品】【3DS】【通常版】スライムもりもりドラゴンクエスト3 大海賊としっぽ団【52%OFF】【あす楽対応_近畿】【あす楽対応_中国】【あす楽対応_四国】【あす楽対応_九州】",
                          catchcopy: "合計5000円以上のお買い上げでメール便1通送料無料！",
                          itemCode: "kenbill:10013270",
                          itemPrice: 2940,
                          itemCaption: "CERO:Aスライムが主人公のアクションアドベンチャー！今度は大海原で3D大冒険！「スライムもりもり」シリーズ第3弾が3DSで登場！■ 奪われたオーブを取り戻せ！今作の物語は、「スーラン王国」という小さな国から始まる。ある日、スーラン王国のお城に悪の組織「しっぽ団」が現れ、王国の大切な宝物である「にじのオーブ」が奪われてしまったのだ！手にした者に強大なチカラを与えるという7つのオーブを取り戻すため、スライムたちは世界へ旅にでるのだ！■ ドラゴンクエストの人気キャラクター・スライムが主人公のアクションアドベンチャー！やわらかボディをグイーンとのばして敵にアタック！そして敵でもナンでも、いろんなものを頭にのせて運べちゃう！楽しいアクションゲーム！■ 冒険の舞台は大海原へ…船バトルでしっぽ団をやっつけろ！今作では、主人公の冒険が全世界に広がる。自分たちの船を手に入れて、大海原へ飛び出そう！しかし、海では敵のしっぽ団が操る海賊船がおそってくるぞ！船バトルでやっつけよう！船はカスタマイズしてパワーアップさせることもできるぞ！",
                          itemUrl: "http://item.rakuten.co.jp/kenbill/4988601007252/",
                          affiliateUrl: "",
                          imageFlag: 1,
                          mediumImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/kenbill/cabinet/3ds/4988601007252.jpg?_ex=128x128"
                            }
                          ],
                          smallImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/kenbill/cabinet/3ds/4988601007252.jpg?_ex=64x64"
                            }
                          ],
                          availability: 1,
                          taxFlag: 0,
                          postageFlag: 1,
                          creditCardFlag: 1,
                          shopOfTheYearFlag: 0,
                          shipOverseasFlag: 1,
                          shipOverseasArea: "ワールドワイド",
                          asurakuFlag: 1,
                          asurakuClosingTime: "13:00",
                          asurakuArea: "滋賀県/京都府/大阪府/兵庫県/奈良県/和歌山県/鳥取県/島根県/岡山県/広島県/山口県/徳島県/香川県/愛媛県/高知県/福岡県/佐賀県/長崎県/熊本県/大分県/宮崎県/鹿児島県",
                          affiliateRate: 1,
                          startTime: "",
                          endTime: "",
                          reviewCount: 3,
                          reviewAverage: 5,
                          pointRate: 1,
                          pointRateStartTime: "",
                          pointRateEndTime: "",
                          giftFlag: 0,
                          shopName: "ゲーム＆ホビー ケンビル Kenbill",
                          shopCode: "kenbill",
                          shopUrl: "http://www.rakuten.co.jp/kenbill/",
                          genreId: "562884"
                        }
                      },
                      {
                        Item: {
                          itemName: "【新品】ニンテンドー3DS専用ソフト/スライムもりもりドラゴンクエスト3 大海賊としっぽ団【あす楽対応】",
                          catchcopy: "",
                          itemCode: "auc-toydragon:10000307",
                          itemPrice: 4199,
                          itemCaption: "任天堂3DS専用ソフト「スライムもりもりドラゴンクエスト3 大海賊としっぽ団」新品未開封での販売です。『スライムもりもりドラゴンクエスト』はスライムが主人公のゲーム。のびて、はねて、せおって、なげるスライムの爽快アクションがそのまま3Dに！冒険の舞台は全世界！ 手に入れた資材やパーツを駆使して、自分だけの船をカスタマイズしよう！ 通信対戦では最大4人で対戦や協力プレイが可能！",
                          itemUrl: "http://item.rakuten.co.jp/auc-toydragon/4988601007252/",
                          affiliateUrl: "",
                          imageFlag: 1,
                          mediumImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/auc-toydragon/cabinet/02984299/02984310/img58641785.jpg?_ex=128x128"
                            },
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/auc-toydragon/cabinet/02984299/02984310/img58641786.jpg?_ex=128x128"
                            }
                          ],
                          smallImageUrls: [
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/auc-toydragon/cabinet/02984299/02984310/img58641785.jpg?_ex=64x64"
                            },
                            {
                              imageUrl: "http://thumbnail.image.rakuten.co.jp/@0_mall/auc-toydragon/cabinet/02984299/02984310/img58641786.jpg?_ex=64x64"
                            }
                          ],
                          availability: 1,
                          taxFlag: 0,
                          postageFlag: 1,
                          creditCardFlag: 1,
                          shopOfTheYearFlag: 0,
                          shipOverseasFlag: 0,
                          shipOverseasArea: "",
                          asurakuFlag: 1,
                          asurakuClosingTime: "15:00",
                          asurakuArea: "群馬県/埼玉県/千葉県/東京都/神奈川県/富山県/石川県/福井県/山梨県/岐阜県/静岡県/愛知県/三重県/滋賀県/京都府/大阪府/兵庫県/奈良県/和歌山県/鳥取県/島根県/岡山県/広島県/山口県/徳島県/香川県/愛媛県/高知県/福岡県/佐賀県/大分県/宮崎県/茨城県/栃木県",
                          affiliateRate: 1,
                          startTime: "",
                          endTime: "",
                          reviewCount: 1,
                          reviewAverage: 5,
                          pointRate: 1,
                          pointRateStartTime: "",
                          pointRateEndTime: "",
                          giftFlag: 0,
                          shopName: "トイどらごんのひみつきち",
                          shopCode: "auc-toydragon",
                          shopUrl: "http://www.rakuten.co.jp/auc-toydragon/",
                          genreId: "562884"
                        }
                      }
                    ]
                  }
    @items = [
      {
        :name => "【中古】afb【ニンテンドー3DS】ドラゴンクエスト7　エデンの戦士たち【4988601007795】【RPG】",
        :image_url => "http://thumbnail.image.rakuten.co.jp/@0_mall/wondergoo/cabinet/03459389/4988601007795.jpg?_ex=64x64"
      },
      {
        :name => "【メール便発送可】【新品】【3DS】【通常版】スライムもりもりドラゴンクエスト3 大海賊としっぽ団【52%OFF】【あす楽対応_近畿】【あす楽対応_中国】【あす楽対応_四国】【あす楽対応_九州】",
        :image_url => "http://thumbnail.image.rakuten.co.jp/@0_mall/kenbill/cabinet/3ds/4988601007252.jpg?_ex=64x64"
      },
      {
        :name =>"【新品】ニンテンドー3DS専用ソフト/スライムもりもりドラゴンクエスト3 大海賊としっぽ団【あす楽対応】",
        :image_url => "http://thumbnail.image.rakuten.co.jp/@0_mall/auc-toydragon/cabinet/02984299/02984310/img58641786.jpg?_ex=64x64"
      }
    ]

    stub_request(:get, RakutenIchiba::FETCH_URL).to_return(json: @response)
  end

  tests SecondTableViewController

  it 'いちらんが表示される' do
    wait 0.2 do
      controller.items.count.should.equal @response[:Items].count
      controller.tableView.numberOfRowsInSection(0).should.equal @response[:Items].count
    end
  end

  #it 'セルをタップすると、しょうさいが表示される' do

  #  # TODO
  #  # Segueで遷移する場合にどう書けばよいのか
  #  #controller.mock!(:'prepareForSegue:sender:') # 呼び出されることだけを確認
  #  #tap views(ItemCell)[0]
  #  true.should.be.true
  #end
end
